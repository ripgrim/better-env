#!/usr/bin/env bun
var G=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(o,e)=>(typeof require<"u"?require:o)[e]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});import $t from"fs";import{createCliRenderer as Zt,GroupRenderable as te}from"@opentui/core";import{getKeyHandler as ee}from"@opentui/core";import{existsSync as lt,mkdirSync as Ot,readFileSync as Lt,writeFileSync as At,appendFileSync as Rt}from"fs";import{join as et}from"path";import{homedir as ut}from"os";import{createTRPCClient as Et,httpBatchLink as Bt}from"@trpc/client";import It from"superjson";var Ct=process.env.BETTER_ENV_API_URL||"http://localhost:3000",L=Et({links:[Bt({url:`${Ct}/api/trpc`,transformer:It,headers(){let t=K();return console.log(`\u{1F511} Loading token for request: ${t?"Found":"Not found"}`),t?{Authorization:`Bearer ${t}`}:{}}})]}),at=class{constructor(){}getCurrentToken(){return K()}hasToken(){let o=K();return o&&o.startsWith("cli_")}async authenticate(o){try{return{success:!0,data:(await L.cli.auth.mutate({token:o})).data}}catch(e){return console.error("CLI Auth Error:",e),{success:!1,error:e instanceof Error?e.message:"Authentication failed"}}}async healthCheck(){try{return{success:!0,data:await L.healthCheck.query()}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Health check failed"}}}async ping(){try{return{success:!0,data:await L.cli.ping.query()}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Ping failed"}}}async getCurrentUser(){try{return{success:!0,data:(await L.cli.user.query()).data}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Failed to get user"}}}async listProjects(){try{return{success:!0,data:(await L.cli.projects.query()).data}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Failed to list projects"}}}async getProject(o){try{return{success:!0,data:(await L.cli.project.query({id:o})).data}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get project"}}}async createProject(o){try{return{success:!0,data:(await L.projects.create.mutate(o)).data}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to create project"}}}async updateProject(o){try{return{success:!0,data:(await L.projects.update.mutate(o)).data}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update project"}}}async deleteProject(o){try{return{success:!0,data:await L.projects.delete.mutate({id:o})}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete project"}}}async addEnvVar(o){try{return{success:!0,data:(await L.projects.envs.add.mutate(o)).data}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to add environment variable"}}}async updateEnvVar(o){try{return{success:!0,data:(await L.projects.envs.update.mutate(o)).data}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update environment variable"}}}async deleteEnvVar(o){try{return{success:!0,data:await L.projects.envs.delete.mutate(o)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete environment variable"}}}},A=new at;var P=t=>{Rt("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)};function K(){try{let t=et(ut(),".better-env","token");if(lt(t))return Lt(t,"utf8").trim()}catch(t){P(`\u274C Error loading token: ${t}`)}return null}function pt(t){P(`\u{1F4BE} Saving token: length=${t.length}, prefix=${t.substring(0,8)}...`);try{let o=et(ut(),".better-env");lt(o)||(P("\u{1F4C1} Creating config directory..."),Ot(o,{recursive:!0}));let e=et(o,"token");At(e,t),P(`\u2705 Token saved to ${e}`)}catch(o){P(`\u274C Error saving token: ${o}`)}}function gt(){try{let t=et(ut(),".better-env","token");lt(t)&&(G("fs").unlinkSync(t),P("\u{1F5D1}\uFE0F Token cleared"))}catch(t){P(`\u274C Error clearing token: ${t}`)}}async function W(){P("\u{1F50D} Checking authentication...");let t=K();if(!t)return P("\u274C No token found"),!1;try{let o=await A.authenticate(t);return P(`\u{1F4CB} Auth result: ${JSON.stringify({success:o.success})}`),o.success?(P("\u2705 Authentication successful!"),!0):((o.error?.includes("Invalid")||o.error?.includes("expired"))&&(P("\u{1F5D1}\uFE0F Token invalid, clearing..."),gt()),P(`\u274C Auth failed: ${o.error}`),!1)}catch(o){return P(`\u274C Auth error: ${o}`),!1}}async function Q(){if(!K())return null;try{let o=await A.getCurrentUser();return o.success?o.data:null}catch(o){return P(`\u274C Get user error: ${o}`),null}}async function ht(){gt()}function mt(){let t=process.env.BETTER_ENV_API_URL||"http://localhost:3000",o=process.platform==="darwin"?"open":process.platform==="win32"?"start":"xdg-open";try{G("child_process").exec(`${o} ${t}/cli`)}catch{console.log(`Please open your browser and go to: ${t}/cli`)}}async function dt(){try{let t="";if(process.platform==="darwin"){let{execSync:o}=G("child_process");t=o("pbpaste",{encoding:"utf8"}).trim()}else if(process.platform==="win32"){let{execSync:o}=G("child_process");t=o("powershell.exe Get-Clipboard",{encoding:"utf8"}).trim()}else{let{execSync:o}=G("child_process");try{t=o("xclip -o -selection clipboard",{encoding:"utf8"}).trim()}catch{try{t=o("xsel --clipboard --output",{encoding:"utf8"}).trim()}catch{return{success:!1}}}}return t&&t.startsWith("cli_")&&(await A.authenticate(t)).success?(pt(t),{success:!0,token:t}):{success:!1}}catch(t){return P(`\u274C Clipboard auth error: ${t}`),{success:!1}}}import Ft from"fs";var vt=0,Mt=300,Z=t=>{Ft.appendFileSync("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)};function ot(t){let o=Date.now();o-vt<Mt||(vt=o,t())}function wt(){let t="splash",o=[],e=null,g=null;function m(l){g=l,Z("\u{1F4E6} Parent container set for screen manager")}function S(l){t=l}function H(){return t}function v(){Z(`\u{1F9F9} Clearing screen (${o.length} elements)`),e&&(e.blur(),e=null),o.forEach(l=>{if(l&&l.id)try{g&&g.remove(l.id),l.destroy?.()}catch{}}),o=[]}function M(l){l&&(Z(`\u2795 Adding element: ${l.id}`),o.push(l),g?(g.add(l),Z(`\u2705 Element ${l.id} added to parent container`)):Z(`\u274C No parent container to add element ${l.id}`))}function C(l){e&&e!==l&&e.blur(),e=l,l&&l.focus&&l.focus()}function j(){e&&e.destroy(),o.forEach(l=>{l&&l.destroy&&l.destroy()})}return{setCurrentScreen:S,getCurrentScreen:H,clearScreen:v,addElement:M,setFocusedElement:C,cleanup:j,setParentContainer:m}}async function xt(t){console.log(`Pulling environment variables from project ${t}...`),await new Promise(o=>setTimeout(o,1e3)),console.log("Pull completed successfully!")}async function yt(t){console.log(`Pushing environment variables to project ${t}...`),await new Promise(o=>setTimeout(o,1e3)),console.log("Push completed successfully!")}import{TextRenderable as Nt,RGBA as bt,FrameBufferRenderable as Dt,renderFontToFrameBuffer as Ut,BoxRenderable as _t,SelectRenderable as qt}from"@opentui/core";var r={background:"#141414",primary:"#e2e8f0",secondary:"#94a3b8",muted:"#64748b",accent:"#ffff00",success:"#00ff00",error:"#ff0000",warning:"#ffaa00",info:"#00ffff",boxBg:"#2a2a2a",boxBorder:"#404040",instructionsBg:"#151515",instructionsBorder:"#2a2a2a",selectBg:"#151515",selectFocusedBg:"#252525",selectText:"#b0b0b0",selectFocusedText:"#e0e0e0",selectSelectedBg:"#404040",selectSelectedText:"#ffffff",selectDescriptionColor:"#707070",selectSelectedDescriptionColor:"#a0a0a0",inputBg:"#1a1a1a",inputText:"#ffffff",inputPlaceholder:"#666666",inputCursor:"#ffff00"},Vt={backgroundColor:r.selectBg,focusedBackgroundColor:r.selectFocusedBg,textColor:r.selectText,focusedTextColor:r.selectFocusedText,selectedBackgroundColor:r.selectSelectedBg,selectedTextColor:r.selectSelectedText,descriptionColor:r.selectDescriptionColor,selectedDescriptionColor:r.selectSelectedDescriptionColor,showScrollIndicator:!0,wrapSelection:!0,showDescription:!0,zIndex:15};function St(t,o){let e=new Dt("ascii-art",{width:t.terminalWidth,height:8,positionType:"absolute",position:o,zIndex:20});return Ut(e.frameBuffer,{text:"BETTER ENV",x:5,y:1,fg:bt.fromInts(255,100,100,255),bg:bt.fromInts(0,0,40,255),font:"block"}),e}function w(t,o,e,g,m={}){return new _t(t,{positionType:"absolute",position:e,width:g.width,height:g.height,bg:m.bg||r.boxBg,borderStyle:m.borderStyle||"rounded",borderColor:m.borderColor||r.boxBorder,title:o,titleAlignment:m.titleAlignment||"center",zIndex:m.zIndex||10})}function I(t,o,e,g){return new qt(t,{positionType:"absolute",position:e,width:g.width,height:g.height,options:o,...Vt})}function i(t,o,e,g={}){return new Nt(t,{content:o,positionType:"absolute",position:e,fg:g.fg||r.primary,bg:g.bg||"transparent",zIndex:g.zIndex||20})}function n(t,o){return Math.floor((t.terminalWidth-o)/2)}var q="\u2191\u2193: Navigate | Enter: Select | Esc: Back";import{InputRenderable as Ht,InputRenderableEvents as zt}from"@opentui/core";import Gt from"fs";var k=t=>{Gt.appendFileSync("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)};function Tt(t,o,e,g,m,S,H){let v=null;function M(){if(k("\u{1F511} Showing login screen..."),g(),m("login"),!o){k("\u274C No parent container for login screen!");return}let $=w("login-title","Authentication Required",{left:n(t,80),top:6},{width:80,height:3});e($);let E=i("login-step1","1. Go to http://localhost:3000/cli to create a CLI token",{left:n(t,55),top:10},{fg:r.secondary});e(E);let O=i("login-step2","2. Copy the generated token",{left:n(t,30),top:11},{fg:r.secondary});e(O);let U=i("login-step3","3. Press 't' to enter token, 'o' to open browser, 'c' for clipboard, SPACE to continue, or 'q' to quit",{left:n(t,85),top:13},{fg:r.muted});e(U)}function C(){if(k("\u{1F4DD} Showing token input screen..."),g(),m("token-input"),!o){k("\u274C No parent container for token input!");return}let $=w("token-title","Enter CLI Token",{left:n(t,80),top:6},{width:80,height:3});e($);let E=w("token-instructions","Instructions",{left:n(t,80),top:12},{width:80,height:8},{bg:r.instructionsBg,borderStyle:"single",borderColor:r.instructionsBorder});e(E),["1. Go to http://localhost:3000/cli in your browser","2. Log in to your account","3. Create a new CLI token","4. Copy the generated token","5. Paste it below and press Enter","6. Token should start with 'cli_'"].forEach((B,u)=>{let h=i(`instruction-${u}`,B,{left:n(t,76),top:14+u},{fg:r.selectText});e(h)});let U=i("token-prompt","CLI Token:",{left:n(t,76),top:22},{fg:r.primary});e(U);let _=i("paste-hint","\u{1F4A1} Tip: You can paste with Ctrl+V (or Cmd+V on Mac)",{left:n(t,50),top:24},{fg:r.muted});e(_),v=new Ht("token-input",{positionType:"absolute",position:{left:n(t,76)+12,top:22},width:60,height:3,zIndex:100,backgroundColor:r.inputBg,textColor:r.inputText,placeholder:"cli_...",placeholderColor:r.inputPlaceholder,cursorColor:r.inputCursor,value:"",maxLength:200}),t&&o&&(t.root.add(v),v.focus()),v.on(zt.ENTER,async B=>{k(`\u{1F511} Token submitted: length=${B.length}, starts with cli_: ${B.startsWith("cli_")}`);let u=B.trim();if(!u){k("\u274C Empty token, returning to login screen"),M();return}if(!u.startsWith("cli_")){k("\u274C Invalid token format (doesn't start with cli_)"),l();return}k("\u{1F4BE} Saving token..."),pt(u),k("\u{1F4E2} Calling onTokenSet callback..."),H(u),k("\u{1F50D} Verifying authentication..."),await W()?(k("\u2705 Authentication successful!"),v&&t&&(t.root.remove(v.id),v.destroy(),v=null),k("\u{1F3AF} Showing splash screen..."),S()):(k("\u274C Authentication failed after token save"),v&&t&&(t.root.remove(v.id),v.destroy(),v=null),l())})}function j(){if(k("\u23F3 Showing authenticating screen..."),g(),m("authenticating"),!o){k("\u274C No parent container for authenticating screen!");return}let $=w("auth-status","Authenticating...",{left:n(t,80),top:10},{width:80,height:6},{borderStyle:"single"});e($);let E=i("auth-status-text","Opening browser for authentication...",{left:n(t,76),top:12},{fg:r.primary});e(E)}function l(){if(g(),m("auth-error"),!o)return;let $=w("error-title","Authentication Failed",{left:n(t,80),top:10},{width:80,height:6},{borderStyle:"single"});e($);let E=i("error-text","Failed to authenticate. Press any key to try again.",{left:n(t,50),top:12},{fg:r.primary});e(E)}function F(){v&&t&&(t.root.remove(v.id),v.destroy(),v=null)}return{showLoginScreen:M,showTokenInput:C,showAuthError:l,showAuthenticating:j,cleanupTokenInput:F}}import{SelectRenderableEvents as Kt}from"@opentui/core";var Jt=[{name:"View Projects",description:"See all your projects and their environment variables",value:"projects"},{name:"Create New Project",description:"Start a new project with environment setup",value:"create"},{name:"Pull Environment Variables",description:"Download env vars from a project",value:"pull"},{name:"Push Environment Variables",description:"Upload env vars to a project",value:"push"},{name:"Profile",description:"View user profile and logout",value:"profile"},{name:"Settings",description:"Configure CLI preferences",value:"settings"},{name:"Quit",description:"Exit the Better Env CLI",value:"quit"}];function Pt(t,o,e,g,m,S,H){function v(){if(g(),m("splash"),!o)return;let C=St(t,{left:0,top:2});e(C);let j=i("subtitle","Better Env CLI - Press any key to continue",{left:2,top:12},{fg:"#6666ff",bg:"#002840"});e(j);let l=i("version","v1.0.0",{left:2,top:14},{fg:r.muted,bg:"transparent"});e(l)}function M(){if(g(),m("main"),!o)return;let C=w("main-title","Better Env CLI - Main Menu",{left:n(t,80),top:6},{width:80,height:3});e(C);let j=I("main-menu",Jt,{left:n(t,76),top:8},{width:76,height:8});j.on(Kt.ITEM_SELECTED,(F,$)=>{S(async()=>{await H($.value)})}),e(j);let l=i("controls-text",q,{left:n(t,40),top:18},{fg:r.muted});e(l),setTimeout(()=>{j&&j.focus()},100)}return{showSplashScreen:v,showMainMenu:M}}import{SelectRenderableEvents as z}from"@opentui/core";import Yt from"fs";var f=t=>{Yt.appendFileSync("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)},Wt=[{id:"1",name:"my-api",envCount:12,description:"Backend API service"},{id:"2",name:"frontend-app",envCount:8,description:"React frontend application"},{id:"3",name:"database-service",envCount:15,description:"Database microservice"}],Xt=[{key:"DATABASE_URL",value:"postgresql://...",environment:"production"},{key:"API_KEY",value:"sk_...",environment:"production"},{key:"DEBUG",value:"false",environment:"production"},{key:"PORT",value:"3000",environment:"development"},{key:"NODE_ENV",value:"development",environment:"development"}];function kt(t,o,e,g,m,S,H,v,M){async function C(){if(f("\u{1F4CB} Showing projects screen..."),g(),m("projects"),!o)return;let u=w("projects-title","Your Projects",{left:n(t,80),top:6},{width:80,height:3});e(u);let h=i("loading-text","Loading projects...",{left:n(t,20),top:12},{fg:r.muted});e(h);try{f("\u{1F310} Fetching projects from API...");let a=await A.listProjects();if(f(`\u{1F4E6} Projects response: ${JSON.stringify({success:a.success,count:a.data?.personal.length||0})}`),o&&o.remove("loading-text"),a.success&&a.data){let s=a.data.personal;if(f(`\u2705 Got ${s.length} projects`),s.length===0){let p=i("no-projects-text","No projects found. Create your first project!",{left:n(t,45),top:12},{fg:r.muted});e(p);let c=i("create-hint","Press 'c' to create a new project or Escape to go back",{left:n(t,50),top:14},{fg:r.secondary});e(c);return}let x=s.map(p=>({name:p.name,description:`${p.envCount} environment variables`,value:p.id})),d=I("projects-list",x,{left:n(t,76),top:8},{width:76,height:12});d.on(z.ITEM_SELECTED,(p,c)=>{S(async()=>{await l(c.value)})}),e(d);let y=i("controls-text",q,{left:n(t,40),top:22},{fg:r.muted});e(y),setTimeout(()=>{d&&d.focus()},100)}else{f("\u274C Failed to fetch projects");let s=i("error-text","Failed to load projects. Check your connection.",{left:n(t,45),top:12},{fg:r.error});e(s)}}catch(a){f(`\u274C Error fetching projects: ${a}`),o&&o.remove("loading-text");let s=i("error-text","Error loading projects. Please try again.",{left:n(t,40),top:12},{fg:r.error});e(s)}}function j(){if(g(),m("create-project"),!o)return;let u=w("create-title","Create New Project",{left:n(t,80),top:8},{width:80,height:8});e(u);let h=i("create-instruction","This feature will be available soon. Use the web interface at http://localhost:3000",{left:n(t,70),top:12},{fg:r.secondary});e(h);let a=i("create-back","Press 'Esc' or 'Backspace' to go back to main menu",{left:n(t,45),top:16},{fg:r.muted});e(a)}async function l(u){if(f(`\u{1F50D} Showing project details for ID: ${u}`),g(),m(`project-details-${u}`),!o){f("\u274C No parent container for project details");return}let h=i("loading-text","Loading project details...",{left:n(t,25),top:12},{fg:r.muted});e(h);try{f("\u{1F310} Fetching project details from API...");let a=await A.getProject(u);if(f(`\u{1F4E6} Project details response: ${JSON.stringify({success:a.success,hasData:!!a.data})}`),o&&o.remove("loading-text"),!a.success||!a.data){f("\u274C Failed to fetch project details");let c=i("error-text","Failed to load project details. Please try again.",{left:n(t,45),top:12},{fg:r.error});e(c);return}let s=a.data;f(`\u2705 Project details loaded: ${s.name}`);let x=w("project-details-title",`Project: ${s.name}`,{left:n(t,80),top:6},{width:80,height:3});e(x);let d=i("project-details-info",`ID: ${s.id}
Name: ${s.name}
Environment Variables: ${s.envs?.length||0}`,{left:n(t,76),top:10},{fg:r.secondary});e(d);let p=I("project-actions",[{name:"View Environment Variables",description:"Browse all env vars for this project",value:"envvars"},{name:"Back to Projects",description:"Return to projects list",value:"back"}],{left:n(t,76),top:18},{width:76,height:2});p.on(z.ITEM_SELECTED,(c,T)=>{S(async()=>{T.value==="envvars"?await F(u):T.value==="back"&&await C()})}),e(p),setTimeout(()=>{p&&p.focus()},100)}catch(a){f(`\u274C Error fetching project details: ${a}`),o&&o.remove("loading-text");let s=i("error-text","Error loading project details. Please try again.",{left:n(t,45),top:12},{fg:r.error});e(s);return}}async function F(u){if(f(`\u{1F527} Showing environment variables for project: ${u}`),g(),m(`project-envvars-${u}`),!o){f("\u274C No parent container for env vars");return}let h=i("loading-text","Loading environment variables...",{left:n(t,35),top:12},{fg:r.muted});e(h);try{f("\u{1F310} Fetching project details for env vars...");let a=await A.getProject(u);if(f(`\u{1F4E6} Env vars response: ${JSON.stringify({success:a.success,envCount:a.data?.envs?.length||0})}`),o&&o.remove("loading-text"),!a.success||!a.data){f("\u274C Failed to fetch project env vars");let c=i("error-text","Failed to load environment variables. Please try again.",{left:n(t,50),top:12},{fg:r.error});e(c);return}let s=a.data;f(`\u2705 Project env vars loaded: ${s.envs?.length||0} variables`);let x=w("envvars-title",`Environment Variables - ${s.name}`,{left:n(t,80),top:6},{width:80,height:3});if(e(x),!s.envs||s.envs.length===0){let c=i("no-env-text","No environment variables found for this project.",{left:n(t,45),top:12},{fg:r.muted});e(c);let T=i("back-hint","Press Escape to go back to project details",{left:n(t,40),top:14},{fg:r.secondary});e(T);return}let d=s.envs.map(c=>({name:c.key,description:`${c.environmentName}: ${c.value.substring(0,30)}...`,value:c.id})),y=I("env-list",d,{left:n(t,76),top:8},{width:76,height:12});y.on(z.ITEM_SELECTED,(c,T)=>{S(()=>{let Y=s.envs?.find(ct=>ct.id===T.value);Y&&$(u,Y)})}),e(y);let p=i("controls-text",q,{left:n(t,40),top:22},{fg:r.muted});e(p),setTimeout(()=>{y&&y.focus()},100)}catch(a){f(`\u274C Error fetching project env vars: ${a}`),o&&o.remove("loading-text");let s=i("error-text","Error loading environment variables. Please try again.",{left:n(t,50),top:12},{fg:r.error});e(s)}}function $(u,h){if(f(`\u{1F50D} Showing env var details: ${h.key}`),g(),m("env-var-details"),!h||!o){f("\u274C No env var or parent container");return}let a=w("env-detail-title",`Environment Variable: ${h.key}`,{left:n(t,80),top:8},{width:80,height:10});e(a);let s=i("env-details",`Key: ${h.key}
Value: ${h.value}
Environment: ${h.environmentName||"default"}
Description: ${h.description||"No description"}
Created: ${new Date(h.createdAt).toLocaleDateString()}`,{left:n(t,76),top:12},{fg:r.secondary});e(s);let d=I("env-actions",[{name:"Copy Value",description:"Copy the environment variable value to clipboard",value:"copy"},{name:"Back to Environment Variables",description:"Return to environment variables list",value:"back"}],{left:n(t,76),top:19},{width:76,height:2});d.on(z.ITEM_SELECTED,(y,p)=>{S(async()=>{if(p.value==="copy")try{process.platform==="darwin"?G("child_process").execSync(`echo "${h.value}" | pbcopy`):process.platform==="win32"?G("child_process").execSync(`echo "${h.value}" | clip`):G("child_process").execSync(`echo "${h.value}" | xclip -selection clipboard`);let c=i("copy-success","\u2705 Value copied to clipboard!",{left:n(t,30),top:23},{fg:r.success});e(c),setTimeout(()=>{o&&o.remove("copy-success")},2e3)}catch(c){f(`\u274C Error copying to clipboard: ${c}`);let T=i("copy-error","\u274C Failed to copy to clipboard",{left:n(t,30),top:23},{fg:r.error});e(T),setTimeout(()=>{o&&o.remove("copy-error")},2e3)}else p.value==="back"&&await F(u)})}),e(d),setTimeout(()=>{d&&d.focus()},100)}async function E(){if(f("\u{1F4E5} Showing pull environment variables screen..."),g(),m("pull-env"),!o)return;let u=w("pull-title","Pull Environment Variables",{left:n(t,80),top:6},{width:80,height:3});e(u);let h=i("pull-instruction","Select a project to pull environment variables from:",{left:n(t,50),top:10},{fg:r.secondary});e(h);let a=i("loading-text","Loading projects...",{left:n(t,20),top:14},{fg:r.muted});e(a);try{f("\u{1F310} Fetching projects for pull...");let s=await A.listProjects();if(f(`\u{1F4E6} Pull projects response: ${JSON.stringify({success:s.success,count:s.data?.personal.length||0})}`),o&&o.remove("loading-text"),!s.success||!s.data||s.data.personal.length===0){f("\u274C No projects available for pull");let p=i("no-projects-text","No projects available to pull from.",{left:n(t,35),top:14},{fg:r.muted});e(p);let c=i("back-hint","Press Escape to go back to main menu",{left:n(t,35),top:16},{fg:r.secondary});e(c);return}let x=s.data.personal.map(p=>({name:p.name,description:`Pull ${p.envCount||0} environment variables from ${p.name}`,value:p.id})),d=I("pull-projects",x,{left:n(t,76),top:12},{width:76,height:10});d.on(z.ITEM_SELECTED,(p,c)=>{S(async()=>{await O(c.value)})}),e(d);let y=i("controls-text",q,{left:n(t,40),top:24},{fg:r.muted});e(y),setTimeout(()=>{d&&d.focus()},100)}catch(s){f(`\u274C Error fetching projects for pull: ${s}`),o&&o.remove("loading-text");let x=i("error-text","Error loading projects. Please try again.",{left:n(t,35),top:14},{fg:r.error});e(x)}}async function O(u){if(f(`\u{1F4E5} Showing pull confirmation for project: ${u}`),g(),m("pull-confirm"),!o)return;let h=i("loading-text","Loading project details...",{left:n(t,25),top:12},{fg:r.muted});e(h);try{let a=await A.getProject(u);if(o&&o.remove("loading-text"),!a.success||!a.data){f("\u274C Failed to fetch project for pull confirmation");let T=i("error-text","Failed to load project details. Please try again.",{left:n(t,45),top:12},{fg:r.error});e(T);return}let s=a.data,x=s.envs?.length||0,d=w("pull-confirm-title","Confirm Pull Operation",{left:n(t,80),top:8},{width:80,height:8});e(d);let y=i("pull-confirm-text",`Are you sure you want to pull ${x} environment variables from "${s.name}"?

This will create/overwrite your local .env file.`,{left:n(t,70),top:12},{fg:r.secondary});e(y);let p=[{name:"Yes, Pull Variables",description:`Download ${x} variables and write to .env file`,value:"confirm"},{name:"Cancel",description:"Go back without pulling",value:"cancel"}],c=I("pull-confirm-select",p,{left:n(t,76),top:18},{width:76,height:2});c.on(z.ITEM_SELECTED,async(T,Y)=>{S(async()=>{Y.value==="confirm"?(await v(u),await E()):await E()})}),e(c),setTimeout(()=>{c&&c.focus()},100)}catch(a){f(`\u274C Error loading project for pull confirmation: ${a}`),o&&o.remove("loading-text");let s=i("error-text","Error loading project details. Please try again.",{left:n(t,45),top:12},{fg:r.error});e(s)}}async function U(){if(f("\u{1F4E4} Showing push environment variables screen..."),g(),m("push-env"),!o)return;let u=w("push-title","Push Environment Variables",{left:n(t,80),top:6},{width:80,height:3});e(u);let h=i("push-instruction","Select a project to push environment variables to:",{left:n(t,50),top:10},{fg:r.secondary});e(h);let a=i("loading-text","Loading projects...",{left:n(t,20),top:14},{fg:r.muted});e(a);try{f("\u{1F310} Fetching projects for push...");let s=await A.listProjects();if(f(`\u{1F4E6} Push projects response: ${JSON.stringify({success:s.success,count:s.data?.personal.length||0})}`),o&&o.remove("loading-text"),!s.success||!s.data||s.data.personal.length===0){f("\u274C No projects available for push");let p=i("no-projects-text","No projects available to push to.",{left:n(t,35),top:14},{fg:r.muted});e(p);let c=i("back-hint","Press Escape to go back to main menu",{left:n(t,35),top:16},{fg:r.secondary});e(c);return}let x=s.data.personal.map(p=>({name:p.name,description:`Push variables to ${p.name}`,value:p.id})),d=I("push-projects",x,{left:n(t,76),top:12},{width:76,height:10});d.on(z.ITEM_SELECTED,(p,c)=>{S(async()=>{await _(c.value)})}),e(d);let y=i("controls-text",q,{left:n(t,40),top:24},{fg:r.muted});e(y),setTimeout(()=>{d&&d.focus()},100)}catch(s){f(`\u274C Error fetching projects for push: ${s}`),o&&o.remove("loading-text");let x=i("error-text","Error loading projects. Please try again.",{left:n(t,35),top:14},{fg:r.error});e(x)}}async function _(u){if(f(`\u{1F4E4} Showing push variable selection for project: ${u}`),g(),m("push-var-selection"),!o)return;let h=i("loading-text","Loading project details...",{left:n(t,25),top:12},{fg:r.muted});e(h);try{let a=await A.getProject(u);if(o&&o.remove("loading-text"),!a.success||!a.data){f("\u274C Failed to fetch project for push var selection");let c=i("error-text","Failed to load project details. Please try again.",{left:n(t,45),top:12},{fg:r.error});e(c);return}let s=a.data;f(`\u2705 Project loaded for push: ${s.name}, ${s.envs?.length||0} env vars`);let x=w("push-vars-title",`Push Variables to ${s.name}`,{left:n(t,80),top:6},{width:80,height:3});if(e(x),!s.envs||s.envs.length===0){let c=i("no-env-text","No environment variables found for this project to push.",{left:n(t,50),top:12},{fg:r.muted});e(c);let T=i("back-hint","Press Escape to go back to project selection",{left:n(t,40),top:14},{fg:r.secondary});e(T);return}let d=s.envs.map(c=>({name:c.key,description:`${c.environmentName||"default"}: ${c.value.substring(0,30)}...`,value:c.id})),y=I("push-vars-list",d,{left:n(t,76),top:10},{width:76,height:12});y.on(z.ITEM_SELECTED,(c,T)=>{S(async()=>{let Y=s.envs?.find(ct=>ct.id===T.value);Y&&await B(u,Y.key)})}),e(y);let p=i("controls-text",q,{left:n(t,40),top:24},{fg:r.muted});e(p),setTimeout(()=>{y&&y.focus()},100)}catch(a){f(`\u274C Error loading project for push var selection: ${a}`),o&&o.remove("loading-text");let s=i("error-text","Error loading project details. Please try again.",{left:n(t,45),top:12},{fg:r.error});e(s)}}function B(u,h){g(),m("push-confirm");let a=Wt.find(c=>c.id===u),s=Xt.find(c=>c.key===h);if(!a||!s||!o)return;let x=w("push-confirm-title","Confirm Push Operation",{left:n(t,80),top:8},{width:80,height:8});e(x);let d=i("push-confirm-text",`Push "${s.key}" to "${a.name}"?

Value: ${s.value}`,{left:n(t,60),top:12},{fg:r.secondary});e(d);let p=I("push-confirm-select",[{name:"Yes, Push Variable",description:"Upload this environment variable",value:"confirm"},{name:"Cancel",description:"Go back without pushing",value:"cancel"}],{left:n(t,76),top:18},{width:76,height:2});p.on(z.ITEM_SELECTED,async(c,T)=>{S(async()=>{T.value==="confirm"?(await M(u),H()):_(u)})}),e(p),setTimeout(()=>{p&&p.focus()},100)}return{showProjects:C,showCreateProject:j,showProjectDetails:l,showProjectEnvVars:F,showPullEnv:E,showPullConfirm:O,showPushEnv:U,showPushVarSelection:_,showPushConfirm:B,showEnvVarDetails:$}}import{SelectRenderableEvents as Qt}from"@opentui/core";function jt(t,o,e,g,m,S,H,v,M){async function C(){if(g(),m("settings"),!o)return;let l=await M(),F=w("settings-title","CLI Settings",{left:n(t,80),top:6},{width:80,height:3});e(F),[`User: ${l?.name||"Not logged in"}`,"Theme: Dark","Auto-save: Enabled","Default Environment: production","Log Level: info","Update Check: Daily","Backup: Enabled"].forEach((O,U)=>{let _=i(`setting-${U}`,O,{left:n(t,76),top:10+U},{fg:r.secondary});e(_)});let E=i("settings-back","Press 'Esc' or 'Backspace' to go back to main menu",{left:n(t,45),top:20},{fg:r.muted});e(E)}async function j(){if(g(),m("profile"),!o)return;let l=await M(),F=w("profile-title","User Profile",{left:n(t,80),top:6},{width:80,height:3});e(F),[`Name: ${l?.name||"Loading..."}`,`Email: ${l?.email||"Loading..."}`,`User ID: ${l?.id||"Loading..."}`,`Status: ${l?"Authenticated":"Error fetching user data"}`].forEach((_,B)=>{let u=i(`user-detail-${B}`,_,{left:n(t,76),top:10+B},{fg:r.secondary});e(u)});let O=I("user-actions",[{name:"Logout",description:"Sign out and return to login screen",value:"logout"},{name:"Back to Main Menu",description:"Return to the main menu",value:"back"}],{left:n(t,76),top:20},{width:76,height:2});O.on(Qt.ITEM_SELECTED,async(_,B)=>{S(async()=>{B.value==="logout"?(await ht(),v()):B.value==="back"&&H()})}),e(O);let U=i("controls-text",q,{left:n(t,40),top:24},{fg:r.muted});e(U),setTimeout(()=>{O&&O.focus()},100)}return{showSettings:C,showUserProfile:j}}var b=t=>{$t.appendFileSync("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)},N=null,J=null,it=null,tt=null,oe=wt(),{setCurrentScreen:nt,getCurrentScreen:X,clearScreen:rt,addElement:st,setFocusedElement:uo,cleanup:ne,setParentContainer:re}=oe,R=null,D=null,V=null,ft=null;async function se(t){switch(t){case"projects":await V.showProjects();break;case"create":V.showCreateProject();break;case"pull":await V.showPullEnv();break;case"push":await V.showPushEnv();break;case"profile":await ft.showUserProfile();break;case"settings":await ft.showSettings();break;case"quit":process.exit(0);break}}async function ie(){await W()?(it=await Q(),D.showSplashScreen()):R.showAuthError()}async function ce(){let t=await dt();t.success&&t.token?(tt=t.token,await W()?(it=await Q(),D.showSplashScreen()):R.showAuthError()):R.showTokenInput()}function ae(t){if(b(`\u{1F3B9} Key event: ${JSON.stringify({name:t.name,sequence:t.sequence,ctrl:t.ctrl,meta:t.meta,shift:t.shift})}`),!t.name||t.name.includes("mouse")||t.sequence==="\x1B[M"){b("\u{1F6AB} Ignoring mouse/touchpad event");return}if(t.ctrl&&t.name==="c"&&process.exit(0),t.name==="escape"||t.name==="backspace"){switch(X()){case"main":D.showSplashScreen();break;case"projects":case"profile":case"settings":D.showMainMenu();break;case"login":process.exit(0);break;case"token-input":R.cleanupTokenInput(),R.showLoginScreen();break;case"project-details":V.showProjects();break;case"project-envvars":let o=X().split("-")[2]||"1";V.showProjectDetails(o);break;case"create-project":case"pull-env":case"push-env":case"env-var-details":D.showMainMenu();break;case"pull-confirm":V.showPullEnv();break;case"push-var-selection":V.showPushEnv();break;case"push-confirm":let e=X().split("-")[2]||"1";V.showPushVarSelection(e);break}return}if(X()==="splash"){D.showMainMenu();return}if(X()==="login"){t.name==="q"?(b("\u{1F6AA} User chose to quit"),process.exit(0)):t.name==="o"?(b("\u{1F310} User chose to open browser"),mt()):t.name==="t"?(b("\u{1F4DD} User chose to enter token"),R.showTokenInput()):t.name==="c"?(b("\u{1F4CB} User chose clipboard auth"),ce()):t.name==="space"||t.name==="return"||t.name==="enter"?(b("\u23ED\uFE0F User pressed space/enter to continue"),ie()):b(`\u{1F6AB} Ignoring key '${t.name}' on login screen`);return}if(X()==="auth-error"){R.showLoginScreen();return}}function le(){!N||!J||(D=Pt(N,J,st,rt,nt,ot,se),R=Tt(N,J,st,rt,nt,()=>D.showSplashScreen(),t=>{tt=t}),V=kt(N,J,st,rt,nt,ot,()=>D.showMainMenu(),xt,yt),ft=jt(N,J,st,rt,nt,ot,()=>D.showMainMenu(),()=>R.showLoginScreen(),Q))}function ue(){R?.cleanupTokenInput&&R.cleanupTokenInput(),ne(),N&&N.destroy()}async function pe(){$t.writeFileSync("/tmp/cli-debug.log",""),b("\u{1F680} Starting CLI..."),N=await Zt({targetFps:30,exitOnCtrlC:!1}),b("\u2705 Renderer created"),N.start(),N.setBackgroundColor(r.background),J=new te("main-container",{positionType:"absolute",position:{left:0,top:0},zIndex:15,visible:!0}),N.root.add(J),b("\u2705 Parent container created and added"),re(J),le(),b("\u2705 Screen components initialized"),ee().on("keypress",ae),process.on("SIGINT",()=>{ue(),process.exit(0)}),b("\u{1F50D} Checking authentication..."),tt=K(),b(`\u{1F511} Token loaded: ${tt?"YES":"NO"}`),tt&&await W()?(b("\u2705 User authenticated, getting user data..."),it=await Q(),b(`\u{1F464} Current user: ${it?.name||"Unknown"}`),b("\u{1F3AF} Showing splash screen..."),D.showSplashScreen()):(b("\u274C User not authenticated, showing login screen..."),R.showLoginScreen()),b("\u{1F3AF} CLI initialization complete")}pe();export{pe as run};
//# sourceMappingURL=index.js.map