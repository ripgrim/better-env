#!/usr/bin/env bun
var Q=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(o,e)=>(typeof require<"u"?require:o)[e]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});import Ot from"fs";import{createCliRenderer as Jt,GroupRenderable as Kt,SelectRenderableEvents as Xt}from"@opentui/core";import{getKeyHandler as Yt}from"@opentui/core";import{existsSync as ct,mkdirSync as Ct,readFileSync as Ft,writeFileSync as Mt,appendFileSync as Rt}from"fs";import{join as nt}from"path";import{homedir as at}from"os";import{createTRPCClient as gt,httpBatchLink as ht}from"@trpc/client";import mt from"superjson";var dt=process.env.BETTER_ENV_API_URL||"http://localhost:3000",M=gt({links:[ht({url:`${dt}/api/trpc`,transformer:mt,headers(){let t=Z();return console.log(`\u{1F511} Loading token for request: ${t?"Found":"Not found"}`),t?{Authorization:`Bearer ${t}`}:{}}})]}),pt=gt({links:[ht({url:`${dt}/api/trpc`,transformer:mt})]}),it=class{constructor(){}getCurrentToken(){return Z()}hasToken(){let o=Z();return o&&o.startsWith("cli_")}async authenticate(o){try{return{success:!0,data:await M.cli.auth.mutate({token:o})}}catch(e){return console.error("CLI Auth Error:",e),{success:!1,error:e instanceof Error?e.message:"Authentication failed"}}}async requestDeviceCode(){try{return{success:!0,data:await pt.cli.deviceAuth.mutate()}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Failed to request device code"}}}async pollForToken(o){try{return{success:!0,data:await pt.cli.deviceToken.mutate({deviceCode:o})}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get token"}}}async healthCheck(){try{return{success:!0,data:await M.healthCheck.query()}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Health check failed"}}}async ping(){try{return{success:!0,data:await M.cli.ping.query()}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Ping failed"}}}async getCurrentUser(){try{return{success:!0,data:await M.cli.user.query()}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Failed to get user"}}}async listProjects(){try{return{success:!0,data:await M.cli.projects.query()}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Failed to list projects"}}}async getProject(o){try{return{success:!0,data:await M.cli.project.query({id:o})}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to get project"}}}async createProject(o){try{return{success:!0,data:await M.projects.create.mutate(o)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to create project"}}}async updateProject(o){try{return{success:!0,data:await M.projects.update.mutate(o)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update project"}}}async deleteProject(o){try{return{success:!0,data:await M.projects.delete.mutate({id:o})}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete project"}}}async addEnvVar(o){try{return{success:!0,data:await M.projects.envs.add.mutate(o)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to add environment variable"}}}async updateEnvVar(o){try{return{success:!0,data:await M.projects.envs.update.mutate(o)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update environment variable"}}}async deleteEnvVar(o){try{return{success:!0,data:await M.projects.envs.delete.mutate(o)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete environment variable"}}}},B=new it;var O=t=>{Rt("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)};function Z(){try{let t=nt(at(),".better-env","token");if(ct(t))return Ft(t,"utf8").trim()}catch(t){O(`\u274C Error loading token: ${t}`)}return null}function vt(t){O(`\u{1F4BE} Saving token: length=${t.length}, prefix=${t.substring(0,8)}...`);try{let o=nt(at(),".better-env");ct(o)||(O("\u{1F4C1} Creating config directory..."),Ct(o,{recursive:!0}));let e=nt(o,"token");Mt(e,t),O(`\u2705 Token saved to ${e}`)}catch(o){O(`\u274C Error saving token: ${o}`)}}function xt(){try{let t=nt(at(),".better-env","token");ct(t)&&(Q("fs").unlinkSync(t),O("\u{1F5D1}\uFE0F Token cleared"))}catch(t){O(`\u274C Error clearing token: ${t}`)}}async function lt(){O("\u{1F50D} Checking authentication...");let t=Z();if(!t)return O("\u274C No token found"),!1;try{let o=await B.authenticate(t);return O(`\u{1F4CB} Auth result: ${JSON.stringify({success:o.success})}`),o.success?(O("\u2705 Authentication successful!"),!0):((o.error?.includes("Invalid")||o.error?.includes("expired"))&&(O("\u{1F5D1}\uFE0F Token invalid, clearing..."),xt()),O(`\u274C Auth failed: ${o.error}`),!1)}catch(o){return O(`\u274C Auth error: ${o}`),!1}}async function wt(){if(!Z())return null;try{let o=await B.getCurrentUser();return o.success?o.data:null}catch(o){return O(`\u274C Get user error: ${o}`),null}}async function yt(){xt()}import Nt from"fs";var bt=0,Dt=300,tt=t=>{Nt.appendFileSync("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)};function et(t){let o=Date.now();o-bt<Dt||(bt=o,t())}function St(){let t="splash",o=[],e=null,f=null;function h(l){f=l,tt("\u{1F4E6} Parent container set for screen manager")}function S(l){t=l}function q(){return t}function w(){tt(`\u{1F9F9} Clearing screen (${o.length} elements)`),e&&(e.blur(),e=null),o.forEach(l=>{if(l&&l.id)try{f&&f.remove(l.id),l.destroy?.()}catch{}}),o=[]}function F(l){l&&(tt(`\u2795 Adding element: ${l.id}`),o.push(l),f?(f.add(l),tt(`\u2705 Element ${l.id} added to parent container`)):tt(`\u274C No parent container to add element ${l.id}`))}function E(l){e&&e!==l&&e.blur(),e=l,l&&l.focus&&l.focus()}function L(){e&&e.destroy(),o.forEach(l=>{l&&l.destroy&&l.destroy()})}return{setCurrentScreen:S,getCurrentScreen:q,clearScreen:w,addElement:F,setFocusedElement:E,cleanup:L,setParentContainer:h}}async function Tt(t){console.log(`Pulling environment variables from project ${t}...`),await new Promise(o=>setTimeout(o,1e3)),console.log("Pull completed successfully!")}async function Pt(t){console.log(`Pushing environment variables to project ${t}...`),await new Promise(o=>setTimeout(o,1e3)),console.log("Push completed successfully!")}import{TextRenderable as jt,BoxRenderable as qt,SelectRenderable as Ut}from"@opentui/core";var n={background:"#141414",primary:"#e2e8f0",secondary:"#94a3b8",muted:"#64748b",accent:"#ffff00",success:"#00ff00",error:"#ff0000",warning:"#ffaa00",info:"#00ffff",boxBg:"#2a2a2a",boxBorder:"#404040",instructionsBg:"#151515",instructionsBorder:"#2a2a2a",selectBg:"#141414",selectFocusedBg:"#141414",selectText:"#b0b0b0",selectFocusedText:"#fff",selectSelectedBg:"#141414",selectSelectedText:"#FC6969",selectDescriptionColor:"#707070",selectSelectedDescriptionColor:"#a0a0a0",inputBg:"#1a1a1a",inputText:"#ffffff",inputPlaceholder:"#666666",inputCursor:"#ffff00"},_t={backgroundColor:n.selectBg,focusedBackgroundColor:n.selectFocusedBg,textColor:n.selectText,focusedTextColor:n.selectFocusedText,selectedBackgroundColor:n.selectSelectedBg,selectedTextColor:n.selectSelectedText,descriptionColor:n.selectDescriptionColor,selectedDescriptionColor:n.selectSelectedDescriptionColor,showScrollIndicator:!0,wrapSelection:!0,showDescription:!0,zIndex:15};function st(t,o){let e=`
 @@@@@@@  @@@@@@@@ @@@@@@@ @@@@@@@ @@@@@@@@ @@@@@@@      @@@@@@@@ @@@  @@@ @@@  @@@
 @@!  @@@ @@!        @@!     @@!   @@!      @@!  @@@     @@!      @@!@!@@@ @@!  @@@
 @!@!@!@  @!!!:!     @!!     @!!   @!!!:!   @!@!!@!      @!!!:!   @!@@!!@! @!@  !@!
 !!:  !!! !!:        !!:     !!:   !!:      !!: :!!      !!:      !!:  !!!  !: .:! 
 :: : ::  : :: :::    :       :    : :: :::  :   : :     : :: ::: ::    :     ::   
                                                                                   
`.trim();return new jt("ascii-logo",{content:e,positionType:"absolute",position:o,fg:"#ff6b6b",bg:"transparent",zIndex:20})}function x(t,o,e,f,h={}){return new qt(t,{positionType:"absolute",position:e,width:f.width,height:f.height,bg:h.bg||n.boxBg,borderStyle:h.borderStyle||"rounded",borderColor:h.borderColor||n.boxBorder,title:o,titleAlignment:h.titleAlignment||"center",zIndex:h.zIndex||10})}function $(t,o,e,f){return new Ut(t,{positionType:"absolute",position:e,width:f.width,height:f.height,options:o,..._t})}function s(t,o,e,f={}){return new jt(t,{content:o,positionType:"absolute",position:e,fg:f.fg||n.primary,bg:f.bg||"transparent",zIndex:f.zIndex||20})}function r(t,o){return Math.floor((t.terminalWidth-o)/2)}var z="\u2191\u2193: Navigate | Enter: Select | Esc: Back";import zt from"fs";var P=t=>{zt.appendFileSync("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)};function kt(t,o,e,f,h,S,q){let w=null;function F(){if(P("\u{1F511} Auto-starting authentication flow..."),f(),h("getting-code"),!o){P("\u274C No parent container for login screen!");return}let A=x("auth-title","\u{1F510} Better Env CLI",{left:r(t,60),top:8},{width:60,height:3});e(A);let C=s("auth-status","Getting authorization code...",{left:r(t,40),top:12},{fg:n.primary});e(C);let j=s("cancel-hint","Press 'q' to quit",{left:r(t,15),top:16},{fg:n.muted});e(j),setTimeout(()=>{E()},1e3)}async function E(){if(P("\u{1F4F1} Starting seamless device authorization..."),f(),h("device-auth"),!o){P("\u274C No parent container for device auth!");return}let A=x("device-title","\u{1F510} Better Env CLI",{left:r(t,60),top:8},{width:60,height:3});e(A);let C=s("auth-status","Opening browser for authorization...",{left:r(t,40),top:12},{fg:n.primary});e(C);let j=await B.requestDeviceCode();if(!j.success||!j.data){P("\u274C Failed to get device code"),l();return}let{deviceCode:U,userCode:D,verificationUri:N,expiresIn:g,interval:d}=j.data,c=`${N}?code=${D}`,i=process.platform==="darwin"?"open":process.platform==="win32"?"start":"xdg-open";try{Q("child_process").exec(`${i} "${c}"`),P(`\u{1F310} Auto-opened browser: ${c}`)}catch(_){P(`\u274C Failed to auto-open browser: ${_}`)}f();let v=x("waiting-title","\u{1F510} Better Env CLI",{left:r(t,60),top:6},{width:60,height:3});e(v);let m=s("browser-opened","Browser opened for authorization",{left:r(t,40),top:10},{fg:n.primary});e(m);let y=x("user-code",`Code: ${D}`,{left:r(t,25),top:12},{width:25,height:3},{borderStyle:"single",bg:n.instructionsBg,borderColor:n.primary});e(y);let p=s("waiting-text","Waiting for browser authorization...",{left:r(t,40),top:16},{fg:n.muted});e(p);let a=s("manual-hint",`Manual: ${N} \u2022 Press 'o' to re-open \u2022 'q' to quit`,{left:r(t,70),top:18},{fg:n.muted});e(a);let b=()=>{try{Q("child_process").exec(`${i} "${c}"`),P(`\u{1F310} Re-opened browser: ${c}`)}catch(_){P(`\u274C Failed to re-open browser: ${_}`)}};global.openBrowserWithCode=b;let T=0,H=Math.floor(g/d);P(`\u{1F504} Starting to poll for token. Max attempts: ${H}`),w=setInterval(async()=>{if(T++,P(`\u{1F4CA} Polling attempt ${T}/${H}`),T>H){P("\u23F0 Device code expired"),w&&(clearInterval(w),w=null),l();return}let _=await B.pollForToken(U);if(_.success&&_.data?.token){P("\u2705 Device authorization successful!"),w&&(clearInterval(w),w=null),f();let Lt=x("success-title","\u2705 Authorization Successful",{left:r(t,60),top:10},{width:60,height:3});e(Lt);let At=s("success-text","welcome, nerd.",{left:r(t,50),top:13},{fg:n.primary});e(At);let ft=_.data.token;vt(ft),q(ft),setTimeout(async()=>{await lt()?(P("\u{1F3AF} Authentication verified, showing splash screen..."),S()):(P("\u274C Token verification failed"),l())},1500)}else _.error&&!_.error.includes("Authorization pending")&&(P(`\u274C Device auth error: ${_.error}`),w&&(clearInterval(w),w=null),l())},d*1e3)}function L(){if(P("\u23F3 Showing authenticating screen..."),f(),h("authenticating"),!o){P("\u274C No parent container for authenticating screen!");return}let A=x("auth-status","Authenticating...",{left:r(t,80),top:10},{width:80,height:6},{borderStyle:"single"});e(A);let C=s("auth-status-text","Opening browser for authentication...",{left:r(t,76),top:12},{fg:n.primary});e(C)}function l(){if(f(),h("auth-error"),!o)return;let A=x("error-title","\u274C Authentication Failed",{left:r(t,60),top:8},{width:60,height:3},{borderStyle:"single",borderColor:"red"});e(A);let C=s("error-text","Something went wrong during authentication.",{left:r(t,45),top:12},{fg:n.muted});e(C);let j=s("retry-text","Press any key to try again, or 'q' to quit",{left:r(t,45),top:14},{fg:n.primary});e(j);let U=s("help-text","\u{1F4A1} Make sure your browser allows popups and you're logged into Better Env",{left:r(t,70),top:16},{fg:n.muted});e(U)}function R(){w&&(clearInterval(w),w=null)}return{showLoginScreen:F,showDeviceAuth:E,showAuthError:l,showAuthenticating:L,cleanup:R}}import{SelectRenderableEvents as Vt}from"@opentui/core";var Ht=[{name:"View Projects",description:"See all your projects and their environment variables",value:"projects"},{name:"Create New Project",description:"Start a new project with environment setup",value:"create"},{name:"Pull Environment Variables",description:"Download env vars from a project",value:"pull"},{name:"Push Environment Variables",description:"Upload env vars to a project",value:"push"},{name:"Profile",description:"View user profile and logout",value:"profile"},{name:"Settings",description:"Configure CLI preferences",value:"settings"},{name:"Quit",description:"Exit the Better Env CLI",value:"quit"}];function $t(t,o,e,f,h,S,q){function w(){if(f(),h("splash"),!o)return;let E=st(t,{left:0,top:2});e(E);let L=s("subtitle","Better Env CLI - Press any key to continue",{left:2,top:12},{fg:"#6666ff",bg:"#002840"});e(L);let l=s("version","v1.0.0",{left:2,top:14},{fg:n.muted,bg:"transparent"});e(l)}function F(){if(f(),h("main"),!o)return;let E=x("main-title","Better Env CLI - Main Menu",{left:r(t,80),top:6},{width:80,height:3});e(E);let L=$("main-menu",Ht,{left:r(t,76),top:8},{width:76,height:8});L.on(Vt.ITEM_SELECTED,(R,A)=>{S(async()=>{await q(A.value)})}),e(L);let l=s("controls-text",z,{left:r(t,40),top:18},{fg:n.muted});e(l),setTimeout(()=>{L&&L.focus()},100)}return{showSplashScreen:w,showMainMenu:F}}import{SelectRenderableEvents as W}from"@opentui/core";import Wt from"fs";var u=t=>{Wt.appendFileSync("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)};function Et(t,o,e,f,h,S,q,w,F){async function E(){if(u("\u{1F4CB} Showing projects screen..."),f(),h("projects"),!o)return;let g=x("projects-title","Your Projects",{left:r(t,80),top:6},{width:80,height:3});e(g);let d=s("loading-text","Loading projects...",{left:r(t,20),top:12},{fg:n.muted});e(d);try{u("\u{1F310} Fetching projects from API...");let c=await B.listProjects();if(u(`\u{1F4E6} Projects response: ${JSON.stringify({success:c.success,count:c.data?.personal.length||0})}`),o&&o.remove("loading-text"),c.success&&c.data){let i=c.data.personal;if(u(`\u2705 Got ${i.length} projects`),i.length===0){let p=s("no-projects-text","No projects found. Create your first project!",{left:r(t,45),top:12},{fg:n.muted});e(p);let a=s("create-hint","Press 'c' to create a new project or Escape to go back",{left:r(t,50),top:14},{fg:n.secondary});e(a);return}let v=i.map(p=>({name:p.name,description:`${p.envCount} environment variables`,value:p.id})),m=$("projects-list",v,{left:r(t,76),top:8},{width:76,height:12});m.on(W.ITEM_SELECTED,(p,a)=>{S(async()=>{await l(a.value)})}),e(m);let y=s("controls-text",z,{left:r(t,40),top:22},{fg:n.muted});e(y),setTimeout(()=>{m&&m.focus()},100)}else{u("\u274C Failed to fetch projects");let i=s("error-text","Failed to load projects. Check your connection.",{left:r(t,45),top:12},{fg:n.error});e(i)}}catch(c){u(`\u274C Error fetching projects: ${c}`),o&&o.remove("loading-text");let i=s("error-text","Error loading projects. Please try again.",{left:r(t,40),top:12},{fg:n.error});e(i)}}function L(){if(f(),h("create-project"),!o)return;let g=x("create-title","Create New Project",{left:r(t,80),top:8},{width:80,height:8});e(g);let d=s("create-instruction","This feature will be available soon. Use the web interface at http://localhost:3000",{left:r(t,70),top:12},{fg:n.secondary});e(d);let c=s("create-back","Press 'Esc' or 'Backspace' to go back to main menu",{left:r(t,45),top:16},{fg:n.muted});e(c)}async function l(g){if(u(`\u{1F50D} Showing project details for ID: ${g}`),f(),h(`project-details-${g}`),!o){u("\u274C No parent container for project details");return}let d=s("loading-text","Loading project details...",{left:r(t,25),top:12},{fg:n.muted});e(d);try{u("\u{1F310} Fetching project details from API...");let c=await B.getProject(g);if(u(`\u{1F4E6} Project details response: ${JSON.stringify({success:c.success,hasData:!!c.data})}`),o&&o.remove("loading-text"),!c.success||!c.data){u("\u274C Failed to fetch project details");let a=s("error-text","Failed to load project details. Please try again.",{left:r(t,45),top:12},{fg:n.error});e(a);return}let i=c.data;u(`\u2705 Project details loaded: ${i.name}`);let v=x("project-details-title",`Project: ${i.name}`,{left:r(t,80),top:6},{width:80,height:3});e(v);let m=s("project-details-info",`ID: ${i.id}
Name: ${i.name}
Environment Variables: ${i.envs?.length||0}`,{left:r(t,76),top:10},{fg:n.secondary});e(m);let p=$("project-actions",[{name:"View Environment Variables",description:"Browse all env vars for this project",value:"envvars"},{name:"Back to Projects",description:"Return to projects list",value:"back"}],{left:r(t,76),top:18},{width:76,height:2});p.on(W.ITEM_SELECTED,(a,b)=>{S(async()=>{b.value==="envvars"?await R(g):b.value==="back"&&await E()})}),e(p),setTimeout(()=>{p&&p.focus()},100)}catch(c){u(`\u274C Error fetching project details: ${c}`),o&&o.remove("loading-text");let i=s("error-text","Error loading project details. Please try again.",{left:r(t,45),top:12},{fg:n.error});e(i);return}}async function R(g){if(u(`\u{1F527} Showing environment variables for project: ${g}`),f(),h(`project-envvars-${g}`),!o){u("\u274C No parent container for env vars");return}let d=s("loading-text","Loading environment variables...",{left:r(t,35),top:12},{fg:n.muted});e(d);try{u("\u{1F310} Fetching project details for env vars...");let c=await B.getProject(g);if(u(`\u{1F4E6} Env vars response: ${JSON.stringify({success:c.success,envCount:c.data?.envs?.length||0})}`),o&&o.remove("loading-text"),!c.success||!c.data){u("\u274C Failed to fetch project env vars");let a=s("error-text","Failed to load environment variables. Please try again.",{left:r(t,50),top:12},{fg:n.error});e(a);return}let i=c.data;u(`\u2705 Project env vars loaded: ${i.envs?.length||0} variables`);let v=x("envvars-title",`Environment Variables - ${i.name}`,{left:r(t,80),top:6},{width:80,height:3});if(e(v),!i.envs||i.envs.length===0){let a=s("no-env-text","No environment variables found for this project.",{left:r(t,45),top:12},{fg:n.muted});e(a);let b=s("back-hint","Press Escape to go back to project details",{left:r(t,40),top:14},{fg:n.secondary});e(b);return}let m=i.envs.map(a=>({name:a.key,description:`${a.environmentName}: ${a.value.substring(0,30)}...`,value:a.id})),y=$("env-list",m,{left:r(t,76),top:8},{width:76,height:12});y.on(W.ITEM_SELECTED,(a,b)=>{S(()=>{let T=i.envs?.find(H=>H.id===b.value);T&&A(g,T)})}),e(y);let p=s("controls-text",z,{left:r(t,40),top:22},{fg:n.muted});e(p),setTimeout(()=>{y&&y.focus()},100)}catch(c){u(`\u274C Error fetching project env vars: ${c}`),o&&o.remove("loading-text");let i=s("error-text","Error loading environment variables. Please try again.",{left:r(t,50),top:12},{fg:n.error});e(i)}}function A(g,d){if(u(`\u{1F50D} Showing env var details: ${d.key}`),f(),h("env-var-details"),!d||!o){u("\u274C No env var or parent container");return}let c=x("env-detail-title",`Environment Variable: ${d.key}`,{left:r(t,80),top:8},{width:80,height:10});e(c);let i=s("env-details",`Key: ${d.key}
Value: ${d.value}
Environment: ${d.environmentName||"default"}
Description: ${d.description||"No description"}
Created: ${new Date(d.createdAt).toLocaleDateString()}`,{left:r(t,76),top:12},{fg:n.secondary});e(i);let m=$("env-actions",[{name:"Copy Value",description:"Copy the environment variable value to clipboard",value:"copy"},{name:"Back to Environment Variables",description:"Return to environment variables list",value:"back"}],{left:r(t,76),top:19},{width:76,height:2});m.on(W.ITEM_SELECTED,(y,p)=>{S(async()=>{if(p.value==="copy")try{process.platform==="darwin"?Q("child_process").execSync(`echo "${d.value}" | pbcopy`):process.platform==="win32"?Q("child_process").execSync(`echo "${d.value}" | clip`):Q("child_process").execSync(`echo "${d.value}" | xclip -selection clipboard`);let a=s("copy-success","\u2705 Value copied to clipboard!",{left:r(t,30),top:23},{fg:n.success});e(a),setTimeout(()=>{o&&o.remove("copy-success")},2e3)}catch(a){u(`\u274C Error copying to clipboard: ${a}`);let b=s("copy-error","\u274C Failed to copy to clipboard",{left:r(t,30),top:23},{fg:n.error});e(b),setTimeout(()=>{o&&o.remove("copy-error")},2e3)}else p.value==="back"&&await R(g)})}),e(m),setTimeout(()=>{m&&m.focus()},100)}async function C(){if(u("\u{1F4E5} Showing pull environment variables screen..."),f(),h("pull-env"),!o)return;let g=x("pull-title","Pull Environment Variables",{left:r(t,80),top:6},{width:80,height:3});e(g);let d=s("pull-instruction","Select a project to pull environment variables from:",{left:r(t,50),top:10},{fg:n.secondary});e(d);let c=s("loading-text","Loading projects...",{left:r(t,20),top:14},{fg:n.muted});e(c);try{u("\u{1F310} Fetching projects for pull...");let i=await B.listProjects();if(u(`\u{1F4E6} Pull projects response: ${JSON.stringify({success:i.success,count:i.data?.personal.length||0})}`),o&&o.remove("loading-text"),!i.success||!i.data||i.data.personal.length===0){u("\u274C No projects available for pull");let p=s("no-projects-text","No projects available to pull from.",{left:r(t,35),top:14},{fg:n.muted});e(p);let a=s("back-hint","Press Escape to go back to main menu",{left:r(t,35),top:16},{fg:n.secondary});e(a);return}let v=i.data.personal.map(p=>({name:p.name,description:`Pull ${p.envCount||0} environment variables from ${p.name}`,value:p.id})),m=$("pull-projects",v,{left:r(t,76),top:12},{width:76,height:10});m.on(W.ITEM_SELECTED,(p,a)=>{S(async()=>{await j(a.value)})}),e(m);let y=s("controls-text",z,{left:r(t,40),top:24},{fg:n.muted});e(y),setTimeout(()=>{m&&m.focus()},100)}catch(i){u(`\u274C Error fetching projects for pull: ${i}`),o&&o.remove("loading-text");let v=s("error-text","Error loading projects. Please try again.",{left:r(t,35),top:14},{fg:n.error});e(v)}}async function j(g){if(u(`\u{1F4E5} Showing pull confirmation for project: ${g}`),f(),h("pull-confirm"),!o)return;let d=s("loading-text","Loading project details...",{left:r(t,25),top:12},{fg:n.muted});e(d);try{let c=await B.getProject(g);if(o&&o.remove("loading-text"),!c.success||!c.data){u("\u274C Failed to fetch project for pull confirmation");let b=s("error-text","Failed to load project details. Please try again.",{left:r(t,45),top:12},{fg:n.error});e(b);return}let i=c.data,v=i.envs?.length||0,m=x("pull-confirm-title","Confirm Pull Operation",{left:r(t,80),top:8},{width:80,height:8});e(m);let y=s("pull-confirm-text",`Are you sure you want to pull ${v} environment variables from "${i.name}"?

This will create/overwrite your local .env file.`,{left:r(t,70),top:12},{fg:n.secondary});e(y);let p=[{name:"Yes, Pull Variables",description:`Download ${v} variables and write to .env file`,value:"confirm"},{name:"Cancel",description:"Go back without pulling",value:"cancel"}],a=$("pull-confirm-select",p,{left:r(t,76),top:18},{width:76,height:2});a.on(W.ITEM_SELECTED,async(b,T)=>{S(async()=>{T.value==="confirm"?(await w(g),await C()):await C()})}),e(a),setTimeout(()=>{a&&a.focus()},100)}catch(c){u(`\u274C Error loading project for pull confirmation: ${c}`),o&&o.remove("loading-text");let i=s("error-text","Error loading project details. Please try again.",{left:r(t,45),top:12},{fg:n.error});e(i)}}async function U(){if(u("\u{1F4E4} Showing push environment variables screen..."),f(),h("push-env"),!o)return;let g=x("push-title","Push Environment Variables",{left:r(t,80),top:6},{width:80,height:3});e(g);let d=s("push-instruction","Select a project to push environment variables to:",{left:r(t,50),top:10},{fg:n.secondary});e(d);let c=s("loading-text","Loading projects...",{left:r(t,20),top:14},{fg:n.muted});e(c);try{u("\u{1F310} Fetching projects for push...");let i=await B.listProjects();if(u(`\u{1F4E6} Push projects response: ${JSON.stringify({success:i.success,count:i.data?.personal.length||0})}`),o&&o.remove("loading-text"),!i.success||!i.data||i.data.personal.length===0){u("\u274C No projects available for push");let p=s("no-projects-text","No projects available to push to.",{left:r(t,35),top:14},{fg:n.muted});e(p);let a=s("back-hint","Press Escape to go back to main menu",{left:r(t,35),top:16},{fg:n.secondary});e(a);return}let v=i.data.personal.map(p=>({name:p.name,description:`Push variables to ${p.name}`,value:p.id})),m=$("push-projects",v,{left:r(t,76),top:12},{width:76,height:10});m.on(W.ITEM_SELECTED,(p,a)=>{S(async()=>{await D(a.value)})}),e(m);let y=s("controls-text",z,{left:r(t,40),top:24},{fg:n.muted});e(y),setTimeout(()=>{m&&m.focus()},100)}catch(i){u(`\u274C Error fetching projects for push: ${i}`),o&&o.remove("loading-text");let v=s("error-text","Error loading projects. Please try again.",{left:r(t,35),top:14},{fg:n.error});e(v)}}async function D(g){if(u(`\u{1F4E4} Showing push variable selection for project: ${g}`),f(),h("push-var-selection"),!o)return;let d=s("loading-text","Loading project details...",{left:r(t,25),top:12},{fg:n.muted});e(d);try{let c=await B.getProject(g);if(o&&o.remove("loading-text"),!c.success||!c.data){u("\u274C Failed to fetch project for push var selection");let a=s("error-text","Failed to load project details. Please try again.",{left:r(t,45),top:12},{fg:n.error});e(a);return}let i=c.data;u(`\u2705 Project loaded for push: ${i.name}, ${i.envs?.length||0} env vars`);let v=x("push-vars-title",`Push Variables to ${i.name}`,{left:r(t,80),top:6},{width:80,height:3});if(e(v),!i.envs||i.envs.length===0){let a=s("no-env-text","No environment variables found for this project to push.",{left:r(t,50),top:12},{fg:n.muted});e(a);let b=s("back-hint","Press Escape to go back to project selection",{left:r(t,40),top:14},{fg:n.secondary});e(b);return}let m=i.envs.map(a=>({name:a.key,description:`${a.environmentName||"default"}: ${a.value.substring(0,30)}...`,value:a.id})),y=$("push-vars-list",m,{left:r(t,76),top:10},{width:76,height:12});y.on(W.ITEM_SELECTED,(a,b)=>{S(async()=>{let T=i.envs?.find(H=>H.id===b.value);T&&await N(g,T.key)})}),e(y);let p=s("controls-text",z,{left:r(t,40),top:24},{fg:n.muted});e(p),setTimeout(()=>{y&&y.focus()},100)}catch(c){u(`\u274C Error loading project for push var selection: ${c}`),o&&o.remove("loading-text");let i=s("error-text","Error loading project details. Please try again.",{left:r(t,45),top:12},{fg:n.error});e(i)}}async function N(g,d){if(u(`\u{1F4E4} Showing push confirmation for project: ${g}, var: ${d}`),f(),h("push-confirm"),!o)return;let c=s("loading-text","Loading project details...",{left:r(t,25),top:12},{fg:n.muted});e(c);try{let i=await B.getProject(g);if(o&&o.remove("loading-text"),!i.success||!i.data){u("\u274C Failed to fetch project for push confirmation");let T=s("error-text","Failed to load project details. Please try again.",{left:r(t,45),top:12},{fg:n.error});e(T);return}let v=i.data,m=v.envs?.find(T=>T.key===d);if(!m){u("\u274C Environment variable not found");let T=s("error-text","Environment variable not found. Please try again.",{left:r(t,45),top:12},{fg:n.error});e(T);return}let y=x("push-confirm-title","Confirm Push Operation",{left:r(t,80),top:8},{width:80,height:8});e(y);let p=s("push-confirm-text",`Push "${m.key}" to "${v.name}"?

Value: ${m.value}
Environment: ${m.environmentName||"default"}`,{left:r(t,70),top:12},{fg:n.secondary});e(p);let b=$("push-confirm-select",[{name:"Yes, Push Variable",description:"Upload this environment variable",value:"confirm"},{name:"Cancel",description:"Go back without pushing",value:"cancel"}],{left:r(t,76),top:19},{width:76,height:2});b.on(W.ITEM_SELECTED,async(T,H)=>{S(async()=>{H.value==="confirm"?(await F(g),q()):await D(g)})}),e(b),setTimeout(()=>{b&&b.focus()},100)}catch(i){u(`\u274C Error loading project for push confirmation: ${i}`),o&&o.remove("loading-text");let v=s("error-text","Error loading project details. Please try again.",{left:r(t,45),top:12},{fg:n.error});e(v)}}return{showProjects:E,showCreateProject:L,showProjectDetails:l,showProjectEnvVars:R,showPullEnv:C,showPullConfirm:j,showPushEnv:U,showPushVarSelection:D,showPushConfirm:N,showEnvVarDetails:A}}import{SelectRenderableEvents as Gt}from"@opentui/core";function Bt(t,o,e,f,h,S,q,w,F){async function E(){if(f(),h("settings"),!o)return;let l=await F(),R=x("settings-title","CLI Settings",{left:r(t,80),top:6},{width:80,height:3});e(R),[`User: ${l?.name||"Not logged in"}`,"Theme: Dark","Auto-save: Enabled","Default Environment: production","Log Level: info","Update Check: Daily","Backup: Enabled"].forEach((j,U)=>{let D=s(`setting-${U}`,j,{left:r(t,76),top:10+U},{fg:n.secondary});e(D)});let C=s("settings-back","Press 'Esc' or 'Backspace' to go back to main menu",{left:r(t,45),top:20},{fg:n.muted});e(C)}async function L(){if(f(),h("profile"),!o)return;let l=await F(),R=x("profile-title","User Profile",{left:r(t,80),top:6},{width:80,height:3});e(R),[`Name: ${l?.name||"Loading..."}`,`Email: ${l?.email||"Loading..."}`,`User ID: ${l?.id||"Loading..."}`,`Status: ${l?"Authenticated":"Error fetching user data"}`].forEach((D,N)=>{let g=s(`user-detail-${N}`,D,{left:r(t,76),top:10+N},{fg:n.secondary});e(g)});let j=$("user-actions",[{name:"Logout",description:"Sign out and return to login screen",value:"logout"},{name:"Back to Main Menu",description:"Return to the main menu",value:"back"}],{left:r(t,76),top:20},{width:76,height:2});j.on(Gt.ITEM_SELECTED,async(D,N)=>{S(async()=>{N.value==="logout"?(await yt(),w()):N.value==="back"&&q()})}),e(j);let U=s("controls-text",z,{left:r(t,40),top:24},{fg:n.muted});e(U),setTimeout(()=>{j&&j.focus()},100)}return{showSettings:E,showUserProfile:L}}var I=t=>{Ot.appendFileSync("/tmp/cli-debug.log",`${new Date().toISOString()} ${t}
`)},k=null,J=null;var Qt=null,Zt=St(),{setCurrentScreen:ot,getCurrentScreen:G,clearScreen:rt,addElement:K,setFocusedElement:ao,cleanup:te,setParentContainer:ee}=Zt,Y=null,X=null,V=null,ut=null;async function oe(t){switch(t){case"projects":await V.showProjects();break;case"create":V.showCreateProject();break;case"pull":await V.showPullEnv();break;case"push":await V.showPushEnv();break;case"profile":await ut.showUserProfile();break;case"settings":await ut.showSettings();break;case"quit":process.exit(0);break}}function It(){if(I("\u{1F44B} Showing welcome screen..."),rt(),ot("welcome"),!J||!k)return;let o=st(k,{left:r(k,76),top:5});K(o);let e=s("welcome-desc","Securely manage your environment variables across projects",{left:r(k,60),top:13},{fg:n.secondary,bg:n.selectBg});K(e);let h=$("welcome-select",[{name:"Login",description:"Authenticate with your better-env account",value:"login"},{name:"Learn More",description:"Visit better-env.com to learn about the platform",value:"learn"},{name:"Exit",description:"Quit the CLI",value:"exit"}],{left:r(k,80),top:16},{width:80,height:6});h.on(Xt.ITEM_SELECTED,(q,w)=>{et(async()=>{switch(w.value){case"login":I("\u{1F464} User selected login"),Y.showLoginScreen();break;case"learn":I("\u{1F4DA} User selected learn more");let F=process.platform==="darwin"?"open":process.platform==="win32"?"start":"xdg-open";try{Q("child_process").exec(`${F} "https://better-env.com"`),I("\u{1F310} Opened better-env.com")}catch(E){I(`\u274C Failed to open browser: ${E}`)}break;case"exit":I("\u{1F6AA} User selected exit"),process.exit(0);break}})}),K(h);let S=s("welcome-hint","\u2191\u2193: Navigate | Enter: Select | Ctrl+C: Exit",{left:r(k,40),top:26},{fg:n.muted});K(S),setTimeout(()=>{h&&h.focus()},100)}function re(t){if(I(`\u{1F3B9} Key event: ${JSON.stringify({name:t.name,sequence:t.sequence,ctrl:t.ctrl,meta:t.meta,shift:t.shift})}`),!t.name||t.name.includes("mouse")||t.sequence==="\x1B[M"){I("\u{1F6AB} Ignoring mouse/touchpad event");return}if(t.ctrl&&t.name==="c"&&process.exit(0),t.name==="escape"||t.name==="backspace"){switch(G()){case"welcome":process.exit(0);break;case"main":X.showSplashScreen();break;case"projects":case"profile":case"settings":X.showMainMenu();break;case"login":case"getting-code":It();break;case"device-auth":Y.cleanup(),Y.showLoginScreen();break;case"project-details":V.showProjects();break;case"project-envvars":let o=G().split("-")[2]||"1";V.showProjectDetails(o);break;case"create-project":case"pull-env":case"push-env":case"env-var-details":X.showMainMenu();break;case"pull-confirm":V.showPullEnv();break;case"push-var-selection":V.showPushEnv();break;case"push-confirm":let e=G().split("-")[2]||"1";V.showPushVarSelection(e);break}return}if(G()!=="welcome"){if(G()==="splash"){X.showMainMenu();return}if(!(G()==="login"||G()==="getting-code")){if(G()==="device-auth"){t.name==="o"&&global.openBrowserWithCode&&global.openBrowserWithCode();return}if(G()==="auth-error"){Y.showLoginScreen();return}}}}function ne(){!k||!J||(X=$t(k,J,K,rt,ot,et,oe),Y=kt(k,J,K,rt,ot,()=>X.showSplashScreen(),t=>{Qt=t,I(`\u{1F504} Token updated globally: ${t?"YES":"NO"}`)}),V=Et(k,J,K,rt,ot,et,()=>X.showMainMenu(),Tt,Pt),ut=Bt(k,J,K,rt,ot,et,()=>X.showMainMenu(),()=>Y.showLoginScreen(),wt))}function se(){Y?.cleanup&&Y.cleanup(),te(),k&&k.destroy()}async function ie(){Ot.writeFileSync("/tmp/cli-debug.log",""),I("\u{1F680} Starting CLI..."),k=await Jt({targetFps:30,exitOnCtrlC:!1}),I("\u2705 Renderer created"),k.start(),k.setBackgroundColor(n.background),J=new Kt("main-container",{positionType:"absolute",position:{left:0,top:0},zIndex:15,visible:!0}),k.root.add(J),I("\u2705 Parent container created and added"),ee(J),ne(),I("\u2705 Screen components initialized"),Yt().on("keypress",re),process.on("SIGINT",()=>{se(),process.exit(0)}),I("\u{1F44B} Showing welcome screen..."),It(),I("\u{1F3AF} CLI initialization complete")}ie();export{ie as run};
//# sourceMappingURL=index.js.map